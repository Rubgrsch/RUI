local _, rui = ...
local B, L, C = unpack(rui)
local MP = B.MP
-- BfA, converted from MDT
local progressList = {
	[141283] = 4,
	[138281] = 6,
	[144286] = 0,
	[141284] = 4,
	[129599] = 3,
	[130653] = 4,
	[137516] = 4,
	[134514] = 9,
	[141285] = 4,
	[150547] = 1,
	[130909] = 4,
	[150292] = 5,
	[133685] = 4,
	[129600] = 3,
	[150165] = 5,
	[135474] = 4,
	[139626] = 1,
	[139946] = 6,
	[126918] = 4,
	[129601] = 4,
	[133943] = 0,
	[130400] = 6,
	[137521] = 4,
	[126919] = 4,
	[137713] = 1,
	[129602] = 6,
	[139949] = 4,
	[127111] = 6,
	[150297] = 4,
	[144293] = 6,
	[134137] = 9,
	[144294] = 4,
	[133436] = 5,
	[144295] = 4,
	[155090] = 4,
	[134331] = 6,
	[127879] = 4,
	[134012] = 6,
	[144296] = 5,
	[131585] = 4,
	[131586] = 4,
	[136249] = 36,
	[130435] = 5,
	[128455] = 6,
	[144298] = 6,
	[136186] = 9,
	[136250] = 4,
	[151325] = 0,
	[144299] = 4,
	[155094] = 4,
	[130404] = 4,
	[151773] = 4,
	[128967] = 4,
	[144300] = 0,
	[134144] = 18,
	[144301] = 1,
	[135167] = 4,
	[135231] = 8,
	[138489] = 8,
	[134338] = 9,
	[131847] = 4,
	[144303] = 4,
	[151649] = 4,
	[128969] = 8,
	[135234] = 3,
	[129640] = 4,
	[131849] = 4,
	[131402] = 1,
	[135235] = 4,
	[141495] = 1,
	[131850] = 4,
	[130024] = 1,
	[134150] = 36,
	[127757] = 4,
	[135365] = 16,
	[137473] = 4,
	[134024] = 1,
	[134599] = 4,
	[135366] = 6,
	[150249] = 4,
	[134600] = 4,
	[129802] = 0,
	[135239] = 4,
	[138369] = 0,
	[150250] = 4,
	[136006] = 0,
	[135048] = 4,
	[130026] = 6,
	[129547] = 4,
	[135240] = 2,
	[133835] = 4,
	[150251] = 4,
	[133963] = 1,
	[135049] = 2,
	[134602] = 4,
	[135241] = 4,
	[151657] = 4,
	[133836] = 4,
	[141565] = 1,
	[130027] = 7,
	[129548] = 4,
	[122969] = 4,
	[141566] = 1,
	[135562] = 2,
	[134157] = 4,
	[131666] = 4,
	[151659] = 4,
	[131858] = 4,
	[135052] = 1,
	[130028] = 7,
	[134158] = 6,
	[122970] = 4,
	[136139] = 12,
	[139269] = 4,
	[135245] = 8,
	[134990] = 4,
	[136076] = 6,
	[161243] = 7,
	[131669] = 1,
	[122971] = 4,
	[134991] = 6,
	[161244] = 7,
	[131670] = 6,
	[127315] = 0,
	[140038] = 2,
	[155432] = 0,
	[122972] = 4,
	[150195] = 4,
	[137484] = 6,
	[155433] = 7,
	[138187] = 4,
	[137485] = 4,
	[128434] = 4,
	[129552] = 6,
	[134739] = 10,
	[122973] = 4,
	[137486] = 4,
	[138061] = 0,
	[137614] = 0,
	[137487] = 4,
	[128435] = 1,
	[151476] = 8,
	[129553] = 10,
	[138255] = 4,
	[134423] = 1,
	[138064] = 0,
	[133593] = 5,
	[131677] = 6,
	[161124] = 7,
	[134616] = 2,
	[138002] = 1,
	[134617] = 1,
	[135192] = 4,
	[144071] = 4,
	[136470] = 4,
	[127799] = 4,
	[137940] = 4,
	[127480] = 1,
	[135258] = 1,
	[134364] = 4,
	[134173] = 1,
	[150142] = 4,
	[136665] = 7,
	[134174] = 5,
	[150143] = 4,
	[131492] = 4,
	[134686] = 4,
	[136347] = 1,
	[133345] = 5,
	[129526] = 4,
	[131685] = 4,
	[150146] = 4,
	[130485] = 12,
	[129527] = 4,
	[139799] = 9,
	[127488] = 7,
	[131445] = 9,
	[135254] = 4,
	[135706] = 3,
	[130025] = 7,
	[127482] = 4,
	[127497] = 9,
	[139800] = 9,
	[131112] = 6,
	[135329] = 10,
	[127485] = 3,
	[150276] = 5,
	[130582] = 0,
	[137029] = 5,
	[135699] = 7,
	[134691] = 4,
	[127381] = 3,
	[127477] = 6,
	[133912] = 6,
	[134284] = 4,
	[131587] = 5,
	[133852] = 4,
	[133663] = 4,
	[128551] = 4,
	[133463] = 12,
	[136353] = 10,
	[131818] = 4,
	[130635] = 4,
	[133990] = 1,
	[137969] = 6,
	[134629] = 6,
	[135204] = 4,
	[150253] = 6,
	[135846] = 2,
	[131819] = 4,
	[150254] = 4,
	[131436] = 6,
	[134139] = 10,
	[151658] = 4,
	[134005] = 1,
	[133432] = 5,
	[129370] = 4,
	[129699] = 4,
	[136295] = 13,
	[130488] = 4,
	[134232] = 4,
	[127486] = 7,
	[161241] = 7,
	[139422] = 6,
	[131821] = 0,
	[138464] = 4,
	[133482] = 1,
	[136297] = 9,
	[136643] = 12,
	[132126] = 4,
	[127119] = 0,
	[150154] = 4,
	[138465] = 4,
	[138019] = 4,
	[130437] = 2,
	[130521] = 1,
	[129366] = 4,
	[126497] = 0,
	[137478] = 6,
	[122984] = 6,
	[133430] = 8,
	[135975] = 0,
	[126928] = 4,
	[137989] = 1,
	[134418] = 9,
	[150293] = 4,
	[134251] = 4,
	[129372] = 4,
	[136934] = 4,
	[129367] = 4,
	[130436] = 1,
	[130011] = 4,
	[152009] = 5,
	[139425] = 4,
	[129550] = 4,
	[68819] = 12,
	[137716] = 0,
	[150168] = 6,
	[138247] = 1,
	[150169] = 4,
	[129788] = 4,
	[134041] = 4,
	[137830] = 4,
	[129373] = 4,
	[133870] = 4,
	[137511] = 4,
	[129369] = 8,
	[130012] = 4,
	[129529] = 4,
	[137517] = 4,
	[130661] = 4,
	[131812] = 6,
	[127106] = 6,
	[133935] = 8,
	[138254] = 1,
	[132530] = 0,
	[129879] = 0,
	[134417] = 12,
	[129928] = 0,
	[150160] = 5,
	[129371] = 4,
	[127124] = 0,
	[139110] = 11,
	[155434] = 7,
	[141282] = 1,
	[134994] = 1,
	[129598] = 0,
	[137474] = 6,
	[136214] = 36,
	[129559] = 4,
	[129374] = 4,
	[132532] = 0,
	[130522] = 2,
}

local function GetNPCID(guid)
	local unitType, _, _, _, _, id = strsplit("-", guid)
	if unitType == "Creature" and id then
		return tonumber(id)
	end
end

local function OnTooltipSetUnit(tooltip)
	if not MP.currentRun.MPing or not C.db.instance.mythicPlus.progress then return end
	local _, unit = tooltip:GetUnit()
	if not unit then return end
	if not UnitCanAttack("player", unit) or UnitIsDead(unit) then return end

	local id = GetNPCID(UnitGUID(unit))
	if not id then return end
	local value = progressList[id]
	if not value then return end

	local _, _, steps = C_Scenario.GetStepInfo()
	local name, _, _, _, totalQuantity = C_Scenario.GetCriteriaInfo(steps)
	if totalQuantity then -- in rare condition it can be nil even MPing is true
		local percent = value / totalQuantity * 100
		percent = math.floor(percent * 100 + 0.5) / 100

		GameTooltip:AddDoubleLine(name, "+" .. percent .. "% (+" .. value .. ")")
		GameTooltip:Show()
	end
end

GameTooltip:HookScript("OnTooltipSetUnit", OnTooltipSetUnit)
